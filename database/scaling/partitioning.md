---
sidebar_position: 1
slug: /scaling/partitioning
---

# Партицирование

**Партицирование** — это процесс разделения одной большой таблицы на более мелкие части, называемые **партициями**. Каждая партиция представляет собой логически независимую часть таблицы, содержащую определенную подгруппу данных, которая управляется и хранится отдельно от других партиций.

Партицирование используется для работы с большими объемами данных, чтобы:

1. **Увеличить производительность** запросов за счет работы только с нужными партициями.
2. **Упростить управление данными**, например, удаление устаревших данных.
3. **Снизить нагрузку на сервер**.
4. **Ускорить операции ввода/вывода**, такие как вставка, обновление и удаление.
5. **Обеспечить гибкость резервного копирования** и восстановления данных.

## Типы партицирования с подробными примерами

### Диапазонное партицирование (Range Partitioning)

При диапазонном партицировании данные распределяются на основе заданных диапазонов значений определенного столбца, например, даты, чисел или других упорядочиваемых данных.

**Пример:**
Вы хотите разделить таблицу заказов по годам. Это позволяет хранить заказы за каждый год в отдельной партиции.

```sql
CREATE TABLE orders (
    order_id INT,
    order_date DATE,
    amount DECIMAL(10, 2)
) PARTITION BY RANGE (YEAR(order_date)) (
    PARTITION p_2021 VALUES LESS THAN (2022), -- Данные за 2021 год
    PARTITION p_2022 VALUES LESS THAN (2023), -- Данные за 2022 год
    PARTITION p_max VALUES LESS THAN MAXVALUE -- Данные за последующие годы
);
```

**Преимущества:**

- Ускоряет поиск по диапазонам (`BETWEEN`, `>`, `<`).
- Удобно для данных с временной характеристикой.

### Списковое партицирование (List Partitioning)

Данные делятся на партиции на основе заранее определенных списков значений. Это полезно, если данные имеют четкие категории, такие как регионы, типы товаров и т. д.

**Пример:**
Разделим таблицу клиентов на партиции в зависимости от их региона.

```sql
CREATE TABLE customers (
    customer_id INT,
    region VARCHAR(50)
) PARTITION BY LIST (region) (
    PARTITION p_north VALUES IN ('North', 'Northeast'),
    PARTITION p_south VALUES IN ('South', 'Southeast'),
    PARTITION p_west VALUES IN ('West', 'Southwest'),
    PARTITION p_other VALUES IN ('Central', 'Unknown')
);
```

**Преимущества:**

- Удобно для данных с явными категориями.
- Простота управления.

### Хэш-партицирование (Hash Partitioning)

Хэш-партицирование используется для равномерного распределения данных между партициями с использованием хэш-функции. Оно особенно полезно, если нет явного критерия для разделения данных.

**Пример:**
Разделим таблицу логов на 4 партиции, используя идентификатор лога.

```sql
CREATE TABLE logs (
    log_id INT,
    log_message TEXT
) PARTITION BY HASH (log_id) PARTITIONS 4;
```

Данные будут автоматически распределяться между партициями в зависимости от значения хэш-функции, вычисляемой для `log_id`.

**Преимущества:**

- Равномерное распределение данных.
- Устранение дисбаланса в объемах данных между партициями.

### Комбинированное партицирование (Composite Partitioning)

Комбинированное партицирование сочетает несколько методов партицирования. Например, сначала данные могут быть разделены по диапазонам, а затем каждая партиция разбита по хэшу.

**Пример:**
Разделим таблицу продаж сначала по годам, а затем разбиваем каждую годовую партицию по регионам.

```sql
CREATE TABLE sales (
    sale_id INT,
    sale_date DATE,
    region VARCHAR(50)
) PARTITION BY RANGE (YEAR(sale_date))
SUBPARTITION BY HASH (region)
SUBPARTITIONS 4 (
    PARTITION p_2021 VALUES LESS THAN (2022),
    PARTITION p_2022 VALUES LESS THAN (2023)
);
```

**Преимущества:**

- Высокая гибкость.
- Возможность справляться со сложными сценариями данных.

## Преимущества партицирования

1. **Ускорение запросов:**
   - Если запросы используют условие фильтрации по критерию партицирования (например, `WHERE YEAR(order_date) = 2022`), СУБД может обрабатывать только нужные партиции.

2. **Легкость управления данными:**
   - Устаревшие данные можно удалить, удалив соответствующую партицию, вместо выполнения дорогостоящих операций удаления строк.

3. **Улучшенная масштабируемость:**
   - Таблицы с партициями легче масштабировать и оптимизировать для большого объема данных.

4. **Эффективное резервное копирование:**
   - Резервное копирование и восстановление могут выполняться для отдельных партиций, что быстрее и эффективнее для больших таблиц.

5. **Повышенная доступность:**
   - Если одна партиция недоступна (например, из-за сбоя диска), другие партиции остаются доступными.

## Недостатки партицирования

1. **Сложность настройки:**
   - Необходим тщательный анализ данных и требований, чтобы выбрать подходящую схему партицирования.

2. **Ограничения на типы данных:**
   - Не все столбцы подходят для партицирования (например, текстовые поля без четкой структуры).

3. **Дополнительные накладные расходы:**
   - Управление партициями может увеличить сложность и объем метаданных.

## Реализация партицирования в популярных СУБД

1. **PostgreSQL:**
   - Поддерживает диапазонное, списковое и хэш-партицирование.
   - Используется команда `PARTITION BY`.

2. **MySQL:**
   - Поддерживает диапазонное, списковое, хэш- и ключевое партицирование.
   - Пример: `PARTITION BY`.

3. **Oracle:**
   - Обеспечивает гибкость, включая поддержку комбинированного партицирования.

4. **SQL Server:**
   - Реализует партицирование через схему партицирования (`partition scheme`) и функцию партицирования (`partition function`).

## Заключение

Партицирование — мощный инструмент для работы с большими объемами данных. Чтобы эффективно использовать его, важно учитывать:
1. Характер данных.
2. Часто используемые запросы.
3. Цели оптимизации производительности.

Выбор правильной стратегии партицирования позволяет ускорить работу системы и упростить управление данными.